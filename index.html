<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>作戦ボード（プロトタイプ）</title>
  <style>
    body { margin: 0; overflow: hidden; touch-action: none; }
    canvas { position: absolute; top: 0; left: 0; }
    img.icon {
      position: absolute;
      width: 50px;
      height: 50px;
      touch-action: none;
      user-select: none;
    }
    .mode-button {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 10px;
      background-color: #fff;
      border: 1px solid #ccc;
      cursor: pointer;
    }
  </style>
</head>
<body>

<!-- 背景用キャンバス -->
<canvas id="backgroundCanvas"></canvas>

<!-- 描画用キャンバス -->
<canvas id="map"></canvas>

<!-- キャラアイコン（例：味方チーム用） -->
<img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Example.svg" class="icon" id="icon1" style="left: 100px; top: 100px;">

<!-- モード切替ボタン -->
<div id="modeButton" class="mode-button">ペンモード</div>

<script>
const canvas = document.getElementById('map');
const ctx = canvas.getContext('2d');
const backgroundCanvas = document.getElementById('backgroundCanvas');
const backgroundCtx = backgroundCanvas.getContext('2d');
const modeButton = document.getElementById('modeButton');
let currentMode = 'pen'; // 初期モードはペン
let drawing = false;
let erasing = false;

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  backgroundCanvas.width = window.innerWidth;
  backgroundCanvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

// 背景マップ（ここは好きなマップ画像に変えてOK）
const background = new Image();
background.src = 'https://github.com/nea1228/eternal-return-board/raw/main/image.png';

background.onload = () => {
  backgroundCtx.drawImage(background, 0, 0, backgroundCanvas.width, backgroundCanvas.height);
};

// モード切替ボタンのクリックイベント
modeButton.addEventListener('click', () => {
  if (currentMode === 'pen') {
    currentMode = 'eraser';
    modeButton.textContent = '消しゴムモード';
    erasing = true;
    ctx.globalCompositeOperation = 'destination-out'; // 消去モードに設定
    ctx.lineWidth = 10; // 消しゴムの太さ
    ctx.strokeStyle = 'rgba(0,0,0,1)'; // 不透明な黒で描画
  } else {
    currentMode = 'pen';
    modeButton.textContent = 'ペンモード';
    erasing = false;
    ctx.globalCompositeOperation = 'source-over'; // 通常の描画モードに戻す
  }
});

// ペンツールでお絵描き
canvas.addEventListener('pointerdown', (e) => {
  drawing = true;
  ctx.beginPath();
  ctx.moveTo(e.clientX, e.clientY);
});
canvas.addEventListener('pointermove', (e) => {
  if (drawing) {
    ctx.lineTo(e.clientX, e.clientY);
    ctx.stroke();
  }
});
canvas.addEventListener('pointerup', () => {
  drawing = false;
});

// アイコンドラッグ
const icon = document.getElementById('icon1');
let dragging = false;
let offsetX, offsetY;

icon.addEventListener('pointerdown', (e) => {
  dragging = true;
  offsetX = e.offsetX;
  offsetY = e.offsetY;
});
document.addEventListener('pointermove', (e) => {
  if (dragging) {
    icon.style.left = (e.clientX - offsetX) + 'px';
    icon.style.top = (e.clientY - offsetY) + 'px';
  }
});
document.addEventListener('pointerup', () => {
  dragging = false;
});
</script>

</body>
</html>
